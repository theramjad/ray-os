Okay, so a week later we're back with even more 
Claude Code updates and I'll be going through  
many of the interesting ones that you can see 
in the list here. But before getting started,  
this video is sponsored by myself 
and my Claude Code Masterclass.  
It is the most comprehensive class on 
Claude Code that you will find online.
And nowadays many companies are paying a 
premium for being able to use Claude Code  
effectively and build natively with it. The new 
year sale is almost over and it will get more  
expensive over time, so it's better to lock 
in the price now. Anyway, so the first thing  
that caught my eye is this brand new setting 
to decide where your planning directory is.
So currently the default on Claude Code 
is it basically stores your plans into  
the `.claude` directory in your computer in 
this plans folder with these random names.  
And it's not really useful to be able to 
then inspect the plan or go back to it,  
or even get another coding 
agent to look through the plan.
But what you can now do in Claude Code is 
that if you define the plans directory in  
your config folder, then you can have it 
saved within the same directory. Then you  
can do other things like getting Gemini 
CLI or Codex CLI to inspect the plan or  
the implementation or review or critique 
the plan, because you can tag the file  
quite easily now. And if you store all 
your plans within your projects folder,  
then you can easily use `grep` to then search for 
your plan history and then improve the performance  
of Claude Code because it has some kind of like 
reference or knowledge of what it did previously.
So to enable this, you want to go to 
your `.claude` folder, `settings.json`,  
and then type in something like this, the path 
where you want your plans to be stored, and  
then making sure you're on the latest version by 
running `claude update` and then running `claude`.
Can you give me a short example plan that 
basically says hello world for a YouTube  
video? And then you can see in the prompt over 
here, it recognized that it should save the plan  
into plans folder. And then afterwards, when I 
do "Yes, and auto-accept edits." Then you can see  
that if I go to folder `youtube/plans`, 
I can see the exact same plan here.
And now that we have the plan, we can tag it in 
a different agent like Codex CLI, for example,  
and basically get it to critique and improve on 
the plan. And you can also turn this into workflow  
using the exit plan mode `PostToolUse` 
hook. So Claude would write the plan,  
you would approve the plan, and then 
the hook gets triggered automatically.
And you could have one hook that would then save 
the plan into a dated folder with a better name,  
for example. And then you can have another hook 
where it would pass it automatically to Codex CLI,  
which is pretty good when it comes to planning. Or 
also Gemini CLI or some other CLI tools as well.
Or you could do something like passing the plan 
into other instances of Claude Code where it's  
running different sub-agents that do different 
reviews. So you could have Claude Code running  
as a security check sub-agent, another 
running as like a cost analysis sub-agent,  
and that basically gives Claude Code 
feedback on the plan for it to go  
through one more iteration and improve on 
the plan automatically. So to basically  
show you what this workflow would look 
like in reality, you can see I have the  
`PostToolUse` exit plan mode matcher, and 
then I have two hooks being triggered.
One of them is archive plan. So essentially 
what the archive plan does is it copies it  
into a dated folder, which looks kind 
of like this with a timestamp and a  
session ID. So Claude Code can refer back 
to previous plans and sessions quite easily.
So you could do something like agentic 
grepping across previous plans and sessions,  
like I've covered in my Claude Code 
Masterclass. And then I have another  
hook here that basically passes that plan into 
headless version of Codex CLI and Gemini CLI  
to get feedback on the plan before going for 
one more iteration and improving on the plan.  
So to basically show you what this looks 
like, can you add ElevenLabs to the macOS  
application so they can use that API key to 
automatically stream words onto their computer.
So pressing that, Claude Code will do the 
usual thing where it comes up with a plan.  
And something else that Claude Code did add to 
planning mode is when it asks you a question,  
you can either say "chat about this" or 
"skip interview and plan immediately." Okay,  
now this plan is done and we 
have even more new features.
Where it says, would you like 
to proceed? You can do "Yes,  
clear context and auto-accept edits." "Yes, 
clear context, manually approve edits." And  
then the two previous options, which is 
"Yes, auto-accept" and "manually approve."
In the same context window. So essentially 
what is happening here in chat number one,  
when Claude Code was planning, 
it spun up a bunch of explore  
sub-agents to look for the code base and 
establish patterns that can be used to  
make a better plan. Those exploration 
results came back to the main session.
It may have done some web fetching or using MCP 
servers to find more things relevant. It did  
the planning with a planning sub-agent, and this 
is a result of the planning sub-agent, and then  
it has a final plan. And you can see now we've 
already used up quite a bit of the context window.
If I remember correctly, this used up about 
60-70,000 tokens so far. And if the plan ends  
up taking quite a lot of tokens to implement, it 
can lead to a compaction happening and then a lot  
of things can be lost in that compaction. And then 
the final plan like won't be executed on properly.
So what I personally did before this update 
was introduced is I would get it to write the  
plan to a brand new file and then load that 
file into brand new chat and then continue  
on and do the plan, execute on the plan in 
that new chat. But now Claude Code provides  
you an option to do that automatically. So if 
you press "Yes, clear context and auto-accept  
edits," basically the final plan will 
just be loaded into brand new chat.
And then as you can see here, we have way more 
room to work with and actually finish on executing  
the plan. But in this case, if I ignore clearing 
the context and do yes, then it will trigger the  
hooks that I have earlier. And yeah, you can 
see here when I finished planning, it took  
about 78,000 tokens, which means that I probably 
should have done it in a brand new context window.
So you can see it called the two hooks here, 
archive plan, review plan. And in archive plan,  
basically I now have it right over here. So 
this is the archived plan in a dated folder.
And then I have some plan reviews as 
well. So this is a review that Codex  
CLI gave the plan. And then this is a 
review that Gemini CLI gave the plan.
And now that goes back into Claude Code. 
So you see external review flagged several  
important issues. Let me address those issues.
Good feedback from external reviewers. And 
now it's going to improve on the plan. And  
actually I forgot to mention we did not 
block the plan from happening because  
Claude Code is now going ahead and 
actually executing on the plan here.
And that's because the verdict that Gemini CLI 
gave is basically warning about issues of the plan  
and the verdict that Codex gave is a warning 
as well. If Codex and Gemini said like, hey,  
we're gonna block the plan, then it would redo 
the plan basically. So if you are interested in  
this hook and workflow to automatically review 
plans with other CLI tools, then you can either  
create the hook yourself or join my Claude 
Code Masterclass where you can download it.
And there's another related lesson as well where 
you can have different sub-agents with different  
skills review plans before you continue with the 
plan. Claude Code has now added planning mode to  
desktop application. So if you make sure local is 
selected over here, you can press plan and then  
basically come up with similar plans like you do 
in the CLI. So this probably means that you can  
have multiple planning agents running in parallel, 
considering plans from different perspectives.
And I hope they do add a planning mode to 
the cloud version because it can be quite  
handy to plan from your phone or have many 
different plans running on the cloud and then  
picking the best one. Now, this one is pretty 
interesting because you can auto-enable MCP  
tool search if your MCP tools were to use more 
than some percentage of your context window.  
So basically what they did recently 
is they added the ability to search  
MCP tools because before in Claude 
Code, if you had a MCP server enabled,  
then it would load every single MCP tool 
and the description of each of the tools.
So previously it would look kind of messy where 
you had the name, description, input schema,  
and a lot of other things about every MCP tool 
loaded into context window at once. But now we  
have one tool called MCP search that is given the 
name of all the tools that you have available from  
MCP servers. And then it can like fetch and get 
more information about each tool if needs be.
Now this requires every MCP server to have 
a descriptive name for each tool that they  
have available. But essentially what it 
means is that by default, if Claude Code  
sees that your MCP tool descriptions would 
take up more than 10% of a context window,  
then it will automatically enable MCP tool 
search, which can give you some token savings,  
which in turn gives you better 
accuracy for longer as well. But  
now you may actually want to change that 10% 
to another number or always have it be on.
And you can do this pretty easily in 
your `settings.json` by adding this as  
an `env` and defining the number 
here. So 20 here would be 20%.
So go into settings file and defining 
`env`, we can set it to either `auto`,  
which is 10% by default, `true`, `false`, 
or `auto`, then a number we specify. So  
I'm going to set it to `auto:5` instead 
because I think 10 is too much. But yeah,  
it's now pretty interesting because 
coding agents are now adopting the  
standard where things are being progressively 
disclosed to coding agent where needs be.
So we already have skills. We now 
have like MCP search tool. And I'm  
guessing we're going to have a lot 
more things like that in the future.
Now, some people were using MCP Porter 
previously where it would call the MCP  
tool with a CLI command. But it turns out 
the Claude Code team tried both and found  
the MCP search tool to work better because 
of like the nuances of people's different  
environments. We now have a brand new hook that 
I've covered in more detail in my Masterclass.
But essentially if you define this hook in your 
settings folder, then you run `claude --init`,  
then it will run Claude normally and it will 
also trigger that hook as well. So you can  
have any commands that run automatically on 
each session of you running Claude Code. If  
you want to do the same thing in headless 
mode instead, you can do `init-only` where  
it will basically run that hook, but not 
actually spin up a session of Claude Code.
So that can be handy if you're 
using it in CI/CD pipelines. Then  
we have `claude --maintenance` where it 
will run Claude Code and also trigger  
another script that you may have. 
So this kind of looks like this.
Basically the way you would differentiate 
between the three modes is you would make a hook  
dispatcher that looks kind of like this. Then you 
would trigger a different script each time. So you  
would have like a script that would automatically 
install any npm packages on your computer, a  
maintenance script that would basically make sure 
that everything is like up to date, for example.
And you could have it do a bunch of other things 
like initialize a repo for a brand new person  
you're onboarding onto a project, start services 
locally on your computer, like a database,  
for example. Or with maintenance, you could 
do like formatting or updating documentation  
by spawning up more instances of Claude Code 
and doing stuff like making sure dependencies  
use of today. So it seems they're trying 
to integrate it more into team workflows.
So you can basically onboard someone, 
tell them to run a `claude --init`,  
and then the projects will be 
automatically set up on their  
computer. `PreToolUse` hooks now support 
additional context that can go to model.
So previously in Claude Code, if Claude Code 
was going to run a command to remove data,  
for example, then it might ask the user for 
permission with a reason that is shown to user,  
but not to Claude Code. But now we have 
additional context that can go back to  
Claude Code to help refine its next steps 
if it tries to do something dangerous.
So as an example, we could allow a tool to be 
called and then pass in additional context saying  
that we are in the production environment and 
that you should proceed with caution. The web and  
desktop version of Claude Code now includes a diff 
view where it shows the lines deleted and added,  
and you can include your own suggestions 
and comments by clicking on any of the  
plus buttons and then typing something in 
here. So pressing enter on a suggestion,  
it will then send it as a brand new 
message with the line and file reference.
When Claude Code now asks for your permission 
to do something, if you choose yes,  
then you can also press tab and then give it 
additional instructions by saying something like,  
for example, I do want it to check out 
this branch, but call it something else,  
so say call it ElevenLabs instead, press enter, 
and then that will be passed alongside the  
approval for that particular permission. They 
added these two variables that allow the status  
line to have a better display of the remaining 
context. So you could copy this over and then go  
to Claude, do `/statusline` to spawn up the 
status line sub-agent, paste that in here,  
and then say can you update the status line 
battery to include this instead for the current  
context window? It now updates the command so 
it doesn't have to do the calculation anymore.
The @autocomplete now added icons for different 
types of suggestions. So doing `@` and typing  
something, `+` basically refers to any files, 
`*` refers to any agents, and then diamond  
refers to any MCP server tools. They now 
merged slash commands and skills together.
So you can still have the commands folder, for 
example, but behind the scenes in Claude Code,  
they are treated as the same thing. 
And then finally in the desktop app,  
they added the ability for you to move Claude 
the crab around by just like hovering over  
it. Anyways, I do go into many of the things in 
much more detail in my Claude Code Masterclass.
There will be a link down below to check 
it out and the new year sale will be ending  
soon and over time the prices will become 
more expensive as I continue to add more  
videos and features. So if you sign up now 
you can lock it in at the current price.